<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SafeStride - Athlete Evaluation (Enhanced)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      .assessment-card {
        transition: all 0.3s ease;
      }
      .assessment-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
      .step-indicator {
        transition: all 0.3s ease;
      }
      .step-indicator.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .test-image {
        max-height: 300px;
        object-fit: contain;
        border-radius: 12px;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50 min-h-screen"
  >
    <!-- Header -->
    <header class="bg-white shadow-sm">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div
              class="w-10 h-10 bg-gradient-to-br from-purple-600 to-blue-600 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-heartbeat text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-2xl font-bold text-gray-800">SafeStride</h1>
              <p class="text-xs text-gray-500">Athlete Evaluation</p>
            </div>
          </div>
          <button
            onclick="window.location.href = 'athlete-signup.html'"
            class="text-sm text-purple-600 hover:text-purple-800"
          >
            <i class="fas fa-arrow-left mr-2"></i>Back to Signup
          </button>
        </div>
      </div>
    </header>

    <!-- Progress Steps -->
    <div class="container mx-auto px-6 py-8">
      <div class="flex items-center justify-center gap-4 mb-8">
        <div
          class="step-indicator active flex items-center gap-2 px-4 py-2 rounded-full bg-purple-600 text-white"
        >
          <i class="fas fa-user"></i>
          <span class="font-semibold">Personal Info</span>
        </div>
        <div class="w-12 h-1 bg-gray-300 rounded"></div>
        <div
          class="step-indicator flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-600"
        >
          <i class="fas fa-clipboard-check"></i>
          <span class="font-semibold">Physical Tests</span>
        </div>
        <div class="w-12 h-1 bg-gray-300 rounded"></div>
        <div
          class="step-indicator flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-600"
        >
          <i class="fas fa-link"></i>
          <span class="font-semibold">Connect Strava</span>
        </div>
      </div>

      <!-- Main Content -->
      <div class="max-w-5xl mx-auto">
        <!-- Step 1: Personal Info -->
        <div id="step1" class="bg-white rounded-2xl shadow-lg p-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">
            Personal Information
          </h2>
          <p class="text-gray-600 mb-8">
            Let's start with some basic details about you
          </p>

          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Full Name *</label
              >
              <input
                type="text"
                id="fullName"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Enter your name"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Age *</label
              >
              <input
                type="number"
                id="age"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Years"
                min="10"
                max="100"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Gender *</label
              >
              <select
                id="gender"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Weight (kg) *</label
              >
              <input
                type="number"
                id="weight"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Enter weight"
                min="30"
                max="200"
                step="0.1"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Height (cm) *</label
              >
              <input
                type="number"
                id="height"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Enter height"
                min="100"
                max="250"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Weekly Distance (km) *</label
              >
              <input
                type="number"
                id="weeklyDistance"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                placeholder="Average per week"
                min="0"
                max="200"
                required
              />
            </div>
          </div>

          <button
            onclick="goToStep2()"
            class="mt-8 w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition"
          >
            Next: Physical Assessment ‚Üí
          </button>
        </div>

        <!-- Step 2: Physical Tests with Images -->
        <div id="step2" class="hidden">
          <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">
              6-Pillar Physical Assessment
            </h2>
            <p class="text-gray-600 mb-6">
              Complete these tests with coach/physiotherapist assistance for
              accurate measurement
            </p>

            <div
              class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg mb-8"
            >
              <p class="text-sm text-blue-900">
                <i class="fas fa-info-circle mr-2"></i>
                <strong>Instructions:</strong> Each test includes a visual
                guide. Follow the images carefully and record your measurements.
                These scores directly affect your AISRI score and training
                recommendations.
              </p>
            </div>
          </div>

          <!-- LOWER BODY TESTS -->
          <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h3 class="text-2xl font-bold text-purple-600 mb-6">
              <i class="fas fa-running mr-2"></i>Lower Body Assessment
            </h3>

            <!-- Test 1: Ankle Dorsiflexion -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Proper Ankle Dorsiflexion Test.png"
                    alt="Ankle Dorsiflexion Test"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    1. Ankle Dorsiflexion Test
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Ground contact time,
                    push-off power<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Face wall, foot perpendicular</li>
                    <li>2. Lunge forward, knee touches wall</li>
                    <li>3. Heel must stay flat on ground</li>
                    <li>4. Measure toe-to-wall distance</li>
                  </ol>
                  <div class="bg-purple-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-purple-900 mb-2"
                      >Distance (cm)</label
                    >
                    <input
                      type="number"
                      id="ankleDorsiflexion"
                      class="w-full px-4 py-2 border border-purple-300 rounded-lg"
                      placeholder="0-15"
                      min="0"
                      max="15"
                      step="0.1"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 10+ cm per foot
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 2: Hip Flexion ROM -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Hip Flexion ROM Test.png"
                    alt="Hip Flexion Test"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    2. Hip Flexion ROM Test
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Stride length, hip
                    drive<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Lie on back</li>
                    <li>2. Pull one knee toward chest</li>
                    <li>3. Keep opposite leg flat</li>
                    <li>4. Measure angle with goniometer</li>
                  </ol>
                  <div class="bg-green-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-green-900 mb-2"
                      >Angle (degrees)</label
                    >
                    <input
                      type="number"
                      id="hipFlexion"
                      class="w-full px-4 py-2 border border-green-300 rounded-lg"
                      placeholder="0-150"
                      min="0"
                      max="150"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 120+ degrees
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 3: Knee Flexion -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Knee Flexion (Heel-to-Buttock) Test.png"
                    alt="Knee Flexion Test"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    3. Knee Flexion (Heel-to-Buttock)
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Recovery phase
                    efficiency<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Lie face down</li>
                    <li>2. Bend knee, bring heel to buttock</li>
                    <li>3. Assistant applies gentle pressure</li>
                    <li>4. Measure heel-buttock gap</li>
                  </ol>
                  <div class="bg-amber-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-amber-900 mb-2"
                      >Gap (cm)</label
                    >
                    <input
                      type="number"
                      id="kneeFlexion"
                      class="w-full px-4 py-2 border border-amber-300 rounded-lg"
                      placeholder="0-20"
                      min="0"
                      max="20"
                      step="0.1"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: Less than 5 cm gap
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 4: Hamstring Flexibility -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Hamstring Flexibility (Sit-and-Reach).png"
                    alt="Hamstring Flexibility"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    4. Hamstring Flexibility (Sit-and-Reach)
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Stride extension,
                    posterior chain<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Sit with legs straight</li>
                    <li>2. Reach forward toward toes</li>
                    <li>3. Keep knees locked</li>
                    <li>4. Measure fingertip-to-toe distance</li>
                  </ol>
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-blue-900 mb-2"
                      >Distance (cm)</label
                    >
                    <input
                      type="number"
                      id="hamstringFlex"
                      class="w-full px-4 py-2 border border-blue-300 rounded-lg"
                      placeholder="-20 to +20"
                      min="-20"
                      max="20"
                      step="0.1"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: Touch toes (0 cm) or beyond
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 5: Single-Leg Squat -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Single-Leg Squat Depth.png"
                    alt="Single-Leg Squat"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    5. Single-Leg Squat Depth
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Knee stability, landing
                    control<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Stand on one leg</li>
                    <li>2. Squat down as far as possible</li>
                    <li>3. Maintain balance and control</li>
                    <li>4. Measure squat depth angle</li>
                  </ol>
                  <div class="bg-purple-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-purple-900 mb-2"
                      >Depth (degrees)</label
                    >
                    <input
                      type="number"
                      id="singleLegSquat"
                      class="w-full px-4 py-2 border border-purple-300 rounded-lg"
                      placeholder="0-130"
                      min="0"
                      max="130"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 90+ degrees flexion
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 6: Hip Abduction Strength -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Hip Abduction Strength Test.png"
                    alt="Hip Abduction"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    6. Hip Abduction Strength Test
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Pelvic stability, ITB
                    stress<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Lie on side</li>
                    <li>2. Lift top leg upward</li>
                    <li>3. Hold for 5 seconds</li>
                    <li>4. Test with resistance band</li>
                  </ol>
                  <div class="bg-green-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-green-900 mb-2"
                      >Repetitions (0-20)</label
                    >
                    <input
                      type="number"
                      id="hipAbduction"
                      class="w-full px-4 py-2 border border-green-300 rounded-lg"
                      placeholder="0-20"
                      min="0"
                      max="20"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 15+ controlled reps
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- BALANCE & CORE TESTS -->
          <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h3 class="text-2xl font-bold text-yellow-600 mb-6">
              <i class="fas fa-balance-scale mr-2"></i>Balance & Core Assessment
            </h3>

            <!-- Test 7: Single-Leg Balance -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/balance test instructional diagram.png"
                    alt="Balance Test"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    7. Single-Leg Balance Test
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Landing stability, energy
                    efficiency<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Stand on one leg</li>
                    <li>2. Close eyes</li>
                    <li>3. Maintain balance</li>
                    <li>4. Record time until loss of balance</li>
                  </ol>
                  <div class="bg-yellow-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-yellow-900 mb-2"
                      >Time (seconds)</label
                    >
                    <input
                      type="number"
                      id="singleLegBalance"
                      class="w-full px-4 py-2 border border-yellow-300 rounded-lg"
                      placeholder="0-60"
                      min="0"
                      max="60"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 20+ seconds eyes closed
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 8: Plank Hold -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Plank Hold Test.png"
                    alt="Plank Test"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    8. Core Strength (Plank Hold)
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Torso stability, energy
                    transfer<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Hold front plank position</li>
                    <li>2. Keep body straight (no sagging)</li>
                    <li>3. Maintain proper form</li>
                    <li>4. Record time until form breaks</li>
                  </ol>
                  <div class="bg-orange-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-orange-900 mb-2"
                      >Time (seconds)</label
                    >
                    <input
                      type="number"
                      id="plankHold"
                      class="w-full px-4 py-2 border border-orange-300 rounded-lg"
                      placeholder="0-300"
                      min="0"
                      max="300"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 60+ seconds
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- UPPER BODY TESTS -->
          <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <h3 class="text-2xl font-bold text-cyan-600 mb-6">
              <i class="fas fa-hands mr-2"></i>Upper Body Mobility
            </h3>

            <!-- Test 9: Shoulder Flexion -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200 mb-6"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Shoulder Flexion ROM.png"
                    alt="Shoulder Flexion"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    9. Shoulder Flexion ROM
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Arm swing efficiency<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Stand or sit upright</li>
                    <li>2. Raise arm forward and up</li>
                    <li>3. Keep arm straight</li>
                    <li>4. Measure maximum angle</li>
                  </ol>
                  <div class="bg-cyan-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-cyan-900 mb-2"
                      >Angle (degrees)</label
                    >
                    <input
                      type="number"
                      id="shoulderFlexion"
                      class="w-full px-4 py-2 border border-cyan-300 rounded-lg"
                      placeholder="0-180"
                      min="0"
                      max="180"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: 170+ degrees
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test 10: Shoulder Internal Rotation -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Shoulder Internal Rotation (Scratch Test).png"
                    alt="Shoulder Rotation"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    10. Shoulder Internal Rotation (Scratch Test)
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Arm carriage, shoulder
                    tension<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Reach behind back</li>
                    <li>2. Try to touch opposite shoulder blade</li>
                    <li>3. Measure distance if fingers don't meet</li>
                    <li>4. Test both sides</li>
                  </ol>
                  <div class="bg-pink-50 p-4 rounded-lg">
                    <label
                      class="block text-sm font-semibold text-pink-900 mb-2"
                      >Distance (cm)</label
                    >
                    <input
                      type="number"
                      id="shoulderRotation"
                      class="w-full px-4 py-2 border border-pink-300 rounded-lg"
                      placeholder="0-30"
                      min="0"
                      max="30"
                      step="0.1"
                    />
                    <p class="text-xs text-gray-600 mt-2">
                      Normal: Fingers touch (0 cm)
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RECOVERY & FATIGUE -->
          <div class="bg-white rounded-2xl shadow-lg p-8">
            <h3 class="text-2xl font-bold text-red-600 mb-6">
              <i class="fas fa-battery-half mr-2"></i>Recovery & Fatigue
              Assessment
            </h3>

            <!-- Fatigue Scale -->
            <div
              class="assessment-card bg-gradient-to-br from-gray-50 to-white p-6 rounded-xl border-2 border-gray-200"
            >
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <img
                    src="../assets/images/assessments/Fatigue Scale Visual.png"
                    alt="Fatigue Scale"
                    class="test-image w-full"
                    onerror="this.style.display = 'none'"
                  />
                </div>
                <div>
                  <h4 class="text-xl font-bold text-gray-800 mb-3">
                    11. Perceived Fatigue Level
                  </h4>
                  <p class="text-sm text-gray-600 mb-4">
                    <strong>üéØ Target Impact:</strong> Recovery status, training
                    readiness<br />
                    <strong>üìè How to Test:</strong>
                  </p>
                  <ol class="text-sm text-gray-700 space-y-2 mb-4">
                    <li>1. Rate your overall fatigue level</li>
                    <li>2. Consider muscle soreness</li>
                    <li>3. Consider energy levels</li>
                    <li>4. Be honest about how you feel today</li>
                  </ol>
                  <div class="bg-red-50 p-4 rounded-lg">
                    <label class="block text-sm font-semibold text-red-900 mb-2"
                      >Fatigue Level (1-10)</label
                    >
                    <input
                      type="range"
                      id="fatigueLevel"
                      class="w-full"
                      min="1"
                      max="10"
                      value="5"
                      oninput="
                        document.getElementById('fatigueValue').textContent =
                          this.value
                      "
                    />
                    <div class="flex justify-between items-center mt-2">
                      <span class="text-xs text-gray-600">Fresh (1)</span>
                      <span
                        id="fatigueValue"
                        class="text-2xl font-bold text-red-600"
                        >5</span
                      >
                      <span class="text-xs text-gray-600">Exhausted (10)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="flex gap-4 mt-8">
            <button
              onclick="goToStep1()"
              class="flex-1 bg-gray-200 text-gray-700 py-4 rounded-lg font-semibold hover:bg-gray-300 transition"
            >
              ‚Üê Back to Personal Info
            </button>
            <button
              onclick="goToStep3()"
              class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition"
            >
              Next: Connect Strava ‚Üí
            </button>
          </div>
        </div>

        <!-- Step 3: Strava Connection -->
        <div id="step3" class="bg-white rounded-2xl shadow-lg p-8 hidden">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">
            Connect Your Fitness Data
          </h2>
          <p class="text-gray-600 mb-8">
            Link Strava or Garmin to enhance your AISRI analysis
          </p>

          <!-- Strava Connection -->
          <div
            class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-6 mb-6"
          >
            <div class="flex items-center gap-4 mb-4">
              <div
                class="w-16 h-16 bg-orange-500 rounded-lg flex items-center justify-center"
              >
                <i class="fas fa-running text-white text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-800">Strava</h3>
                <p class="text-sm text-gray-600">
                  Connect your running activities
                </p>
              </div>
            </div>
            <button
              onclick="connectStrava()"
              class="w-full bg-orange-500 text-white py-3 rounded-lg font-semibold hover:bg-orange-600 transition"
            >
              <i class="fab fa-strava mr-2"></i>Connect Strava Account
            </button>
            <p class="text-xs text-gray-600 mt-3">
              <i class="fas fa-check-circle text-green-600 mr-1"></i>
              Automatically imports: distance, pace, heart rate, personal bests
            </p>
          </div>

          <!-- Garmin Connection -->
          <div
            class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-6 mb-6"
          >
            <div class="flex items-center gap-4 mb-4">
              <div
                class="w-16 h-16 bg-blue-600 rounded-lg flex items-center justify-center"
              >
                <i class="fas fa-heartbeat text-white text-2xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-gray-800">Garmin Connect</h3>
                <p class="text-sm text-gray-600">Advanced biomechanics data</p>
              </div>
            </div>
            <button
              onclick="connectGarmin()"
              class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
            >
              <i class="fas fa-link mr-2"></i>Connect Garmin Account
            </button>
            <p class="text-xs text-gray-600 mt-3">
              <i class="fas fa-check-circle text-green-600 mr-1"></i>
              Includes: cadence, vertical oscillation, ground contact time, VO2
              max
            </p>
          </div>

          <div class="bg-gray-50 rounded-lg p-4 mb-6">
            <p class="text-sm text-gray-700">
              <i class="fas fa-info-circle text-blue-500 mr-2"></i>
              <strong>Optional:</strong> You can skip this step and complete the
              assessment manually. However, connecting fitness platforms
              provides more accurate analysis.
            </p>
          </div>

          <!-- Navigation Buttons -->
          <div class="flex gap-4">
            <button
              onclick="goToStep2()"
              class="flex-1 bg-gray-200 text-gray-700 py-4 rounded-lg font-semibold hover:bg-gray-300 transition"
            >
              ‚Üê Back to Tests
            </button>
            <button
              onclick="skipConnection()"
              class="flex-1 bg-gray-400 text-white py-4 rounded-lg font-semibold hover:bg-gray-500 transition"
            >
              Skip for Now
            </button>
            <button
              onclick="submitEvaluation()"
              class="flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white py-4 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 transition"
            >
              Complete Assessment ‚úì
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16 py-6">
      <div class="container mx-auto px-6 text-center text-sm text-gray-600">
        <p>SafeStride ¬© 2026 | AI-Powered Injury Prevention & Training</p>
      </div>
    </footer>

    <script>
      // Supabase initialization
      const SUPABASE_URL = "https://bdisppaxbvygsspcuymb.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJkaXNwcGF4YnZ5Z3NzcGN1eW1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU2NDY5NTQsImV4cCI6MjA1MTIyMjk1NH0.u9gU0dVkGQGNJqV9YtKPVWaYprxQ4YB4vQsj-VTh8Lo";
      const supabaseClient = supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY,
      );

      let athleteData = {};

      // Step navigation
      function goToStep1() {
        document.getElementById("step1").classList.remove("hidden");
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step3").classList.add("hidden");
        updateStepIndicators(1);
      }

      function goToStep2() {
        // Save Step 1 data
        athleteData.fullName = document.getElementById("fullName").value;
        athleteData.age = parseInt(document.getElementById("age").value);
        athleteData.gender = document.getElementById("gender").value;
        athleteData.weight = parseFloat(
          document.getElementById("weight").value,
        );
        athleteData.height = parseInt(document.getElementById("height").value);
        athleteData.weeklyDistance = parseInt(
          document.getElementById("weeklyDistance").value,
        );

        if (
          !athleteData.fullName ||
          !athleteData.age ||
          !athleteData.weight ||
          !athleteData.height
        ) {
          alert("Please fill all required fields");
          return;
        }

        document.getElementById("step1").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
        document.getElementById("step3").classList.add("hidden");
        updateStepIndicators(2);
        window.scrollTo(0, 0);
      }

      function goToStep3() {
        // Save Step 2 data (test measurements)
        athleteData.tests = {
          ankleDorsiflexion:
            parseFloat(document.getElementById("ankleDorsiflexion").value) || 0,
          hipFlexion:
            parseFloat(document.getElementById("hipFlexion").value) || 0,
          kneeFlexion:
            parseFloat(document.getElementById("kneeFlexion").value) || 0,
          hamstringFlex:
            parseFloat(document.getElementById("hamstringFlex").value) || 0,
          singleLegSquat:
            parseFloat(document.getElementById("singleLegSquat").value) || 0,
          hipAbduction:
            parseFloat(document.getElementById("hipAbduction").value) || 0,
          singleLegBalance:
            parseFloat(document.getElementById("singleLegBalance").value) || 0,
          plankHold:
            parseFloat(document.getElementById("plankHold").value) || 0,
          shoulderFlexion:
            parseFloat(document.getElementById("shoulderFlexion").value) || 0,
          shoulderRotation:
            parseFloat(document.getElementById("shoulderRotation").value) || 0,
          fatigueLevel:
            parseInt(document.getElementById("fatigueLevel").value) || 5,
        };

        // Calculate pillar scores from test results
        athleteData.pillars = calculatePillarScores(athleteData.tests);

        document.getElementById("step1").classList.add("hidden");
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step3").classList.remove("hidden");
        updateStepIndicators(3);
        window.scrollTo(0, 0);
      }

      function updateStepIndicators(currentStep) {
        const indicators = document.querySelectorAll(".step-indicator");
        indicators.forEach((indicator, index) => {
          if (index + 1 <= currentStep) {
            indicator.classList.add("active");
          } else {
            indicator.classList.remove("active");
          }
        });
      }

      // Calculate 6-pillar scores from physical test measurements
      function calculatePillarScores(tests) {
        // Scoring algorithms based on biomechanical research
        const running = 50; // Will be calculated from Strava data
        const rom = Math.min(
          100,
          (tests.ankleDorsiflexion / 12) * 25 +
            (tests.hipFlexion / 120) * 25 +
            (tests.kneeFlexion > 5 ? 0 : 25) +
            (tests.hamstringFlex >= 0 ? 25 : (tests.hamstringFlex + 20) * 1.25),
        );
        const strength = Math.min(
          100,
          (tests.singleLegSquat / 90) * 33 +
            (tests.hipAbduction / 15) * 33 +
            (tests.plankHold / 60) * 34,
        );
        const balance = Math.min(100, (tests.singleLegBalance / 30) * 100);
        const mobility = Math.min(
          100,
          (tests.shoulderFlexion / 170) * 50 +
            (tests.shoulderRotation <= 5
              ? 50
              : (10 - tests.shoulderRotation) * 10),
        );
        const alignment = 70; // Requires video gait analysis

        return {
          running: Math.round(running),
          rom: Math.round(rom),
          strength: Math.round(strength),
          balance: Math.round(balance),
          mobility: Math.round(mobility),
          alignment: Math.round(alignment),
        };
      }

      // Strava OAuth
      function connectStrava() {
        const clientId = "142449"; // Your Strava Client ID
        const redirectUri = `${window.location.origin}/web/training-plan-builder.html`;
        const scope = "read,activity:read_all";

        window.location.href = `https://www.strava.com/oauth/authorize?client_id=${clientId}&response_type=code&redirect_uri=${encodeURIComponent(redirectUri)}&approval_prompt=auto&scope=${scope}`;
      }

      // Garmin connection (placeholder)
      function connectGarmin() {
        alert(
          "üîµ Garmin Connect integration coming soon!\n\nWhen connected, we'll import:\n- Advanced running dynamics\n- VO2 max estimates\n- Training status\n- Recovery metrics\n- Ground contact time\n- Vertical oscillation",
        );
      }

      // Skip connection and proceed
      function skipConnection() {
        if (
          confirm(
            "Skip fitness platform connection? You can add this later from your dashboard.",
          )
        ) {
          submitEvaluation();
        }
      }

      // Submit evaluation to Supabase
      async function submitEvaluation() {
        try {
          console.log("Submitting evaluation:", athleteData);

          // Calculate AISRI score
          const aisriScore = calculateAISRIScore(athleteData.pillars);
          const riskCategory = getRiskCategory(aisriScore);

          // Save to Supabase
          const { data, error } = await supabaseClient
            .from("aisri_assessments")
            .insert({
              athlete_name: athleteData.fullName,
              age: athleteData.age,
              gender: athleteData.gender,
              weight_kg: athleteData.weight,
              height_cm: athleteData.height,
              weekly_distance_km: athleteData.weeklyDistance,
              pillar_scores: athleteData.pillars,
              test_measurements: athleteData.tests,
              aisri_score: aisriScore,
              risk_category: riskCategory,
              assessment_date: new Date().toISOString(),
            });

          if (error) throw error;

          alert(
            `‚úÖ Assessment Complete!\n\nAISRI Score: ${aisriScore}/1000\nRisk Level: ${riskCategory}\n\nRedirecting to training plan builder...`,
          );

          // Redirect to training plan builder
          setTimeout(() => {
            window.location.href = "training-plan-builder.html";
          }, 2000);
        } catch (error) {
          console.error("Error submitting evaluation:", error);
          alert(
            "Error saving assessment. Please try again or contact support.",
          );
        }
      }

      // Calculate AISRI score (0-1000)
      function calculateAISRIScore(pillars) {
        const weights = {
          running: 0.4,
          strength: 0.15,
          rom: 0.12,
          balance: 0.13,
          alignment: 0.1,
          mobility: 0.1,
        };
        const weightedSum = Object.keys(pillars).reduce((sum, key) => {
          return sum + pillars[key] * weights[key];
        }, 0);
        return Math.round(weightedSum * 10);
      }

      // Get risk category
      function getRiskCategory(score) {
        if (score >= 800) return "Low Risk";
        if (score >= 600) return "Moderate Risk";
        if (score >= 400) return "High Risk";
        return "Critical Risk";
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        console.log("Enhanced Athlete Evaluation loaded");
      });
    </script>
  </body>
</html>
