<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SafeStride - Sign Up with Strava</title>
    <link rel="icon" href="favicon.ico" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        max-width: 500px;
        width: 100%;
      }

      .card {
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 48px 40px;
        text-align: center;
      }

      .logo {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
        box-shadow: 0 8px 24px rgba(249, 115, 22, 0.3);
      }

      .logo svg {
        width: 50px;
        height: 50px;
        fill: white;
      }

      h1 {
        font-size: 36px;
        font-weight: 800;
        color: #1f2937;
        margin-bottom: 8px;
        letter-spacing: -0.5px;
      }

      .tagline {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 40px;
      }

      .strava-button {
        background: #fc4c02;
        color: white;
        border: none;
        border-radius: 12px;
        padding: 16px 32px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(252, 76, 2, 0.3);
      }

      .strava-button:hover {
        background: #e34402;
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(252, 76, 2, 0.4);
      }

      .strava-button:active {
        transform: translateY(0);
      }

      .strava-icon {
        width: 24px;
        height: 24px;
      }

      .benefits {
        margin-top: 40px;
        text-align: left;
      }

      .benefits-title {
        font-size: 18px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }

      .benefit {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 16px;
      }

      .benefit-icon {
        width: 40px;
        height: 40px;
        background: #fef3c7;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .benefit-icon svg {
        width: 20px;
        height: 20px;
        fill: #f97316;
      }

      .benefit-content {
        flex: 1;
      }

      .benefit-title {
        font-size: 15px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 4px;
      }

      .benefit-description {
        font-size: 13px;
        color: #6b7280;
        line-height: 1.5;
      }

      .terms {
        margin-top: 24px;
        font-size: 12px;
        color: #9ca3af;
        line-height: 1.6;
      }

      .terms a {
        color: #f97316;
        text-decoration: none;
      }

      .terms a:hover {
        text-decoration: underline;
      }

      .loading {
        display: none;
        margin-top: 16px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        width: 40px;
        height: 40px;
        margin: 0 auto;
        border: 4px solid #f3f4f6;
        border-top-color: #f97316;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        margin-top: 12px;
        font-size: 14px;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <!-- Logo -->
        <div class="logo">
          <svg viewBox="0 0 24 24">
            <path
              d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z"
            />
          </svg>
        </div>

        <!-- Title -->
        <h1>SafeStride</h1>
        <p class="tagline">AI-Powered Injury-Free Training</p>

        <!-- Sign Up Button -->
        <button class="strava-button" onclick="signUpWithStrava()">
          <svg class="strava-icon" viewBox="0 0 384 384" fill="white">
            <path
              d="M158.4 0L90.9 160h64.2l23.3-46.9L201.6 160h64.2L158.4 0zm48.5 211.2l-23.2 46.9-23.3-46.9h-64.2L201.6 384l105.3-172.8h-64.2z"
            />
          </svg>
          <span>Sign Up with Strava</span>
        </button>

        <!-- Loading State -->
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p class="loading-text">Connecting to Strava...</p>
        </div>

        <!-- Benefits -->
        <div class="benefits">
          <div class="benefits-title">What you get:</div>

          <div class="benefit">
            <div class="benefit-icon">
              <svg viewBox="0 0 24 24">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
              </svg>
            </div>
            <div class="benefit-content">
              <div class="benefit-title">Auto-filled profile</div>
              <div class="benefit-description">
                Name, age, weight from your Strava account
              </div>
            </div>
          </div>

          <div class="benefit">
            <div class="benefit-icon">
              <svg viewBox="0 0 24 24">
                <path
                  d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"
                />
              </svg>
            </div>
            <div class="benefit-content">
              <div class="benefit-title">Complete activity history</div>
              <div class="benefit-description">
                All your runs, PBs, total mileage synced automatically
              </div>
            </div>
          </div>

          <div class="benefit">
            <div class="benefit-icon">
              <svg viewBox="0 0 24 24">
                <path
                  d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"
                />
              </svg>
            </div>
            <div class="benefit-content">
              <div class="benefit-title">AISRI injury score</div>
              <div class="benefit-description">
                Real-time biomechanics analysis from your runs
              </div>
            </div>
          </div>

          <div class="benefit">
            <div class="benefit-icon">
              <svg viewBox="0 0 24 24">
                <path d="M7 2v11h3v9l7-12h-4l4-8z" />
              </svg>
            </div>
            <div class="benefit-content">
              <div class="benefit-title">Personalized timeline</div>
              <div class="benefit-description">
                Your journey to 3:30/km pace with injury prevention
              </div>
            </div>
          </div>

          <div class="benefit">
            <div class="benefit-icon">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"
                />
              </svg>
            </div>
            <div class="benefit-content">
              <div class="benefit-title">AI workouts</div>
              <div class="benefit-description">
                Daily training plans optimized for your fitness level
              </div>
            </div>
          </div>
        </div>

        <!-- Terms -->
        <p class="terms">
          By signing up, you agree to our
          <a href="/terms">Terms of Service</a> and
          <a href="/privacy">Privacy Policy</a>
        </p>
      </div>
    </div>

    <script>
      // Strava OAuth Configuration
      const STRAVA_CLIENT_ID = "162971";
      const REDIRECT_URI = "https://akura.in/strava-callback";
      const SCOPE = "read,activity:read_all,profile:read_all";

      function signUpWithStrava() {
        // Show loading state
        document.querySelector(".strava-button").style.display = "none";
        document.getElementById("loading").classList.add("show");

        // Build Strava OAuth URL
        const authUrl = new URL("https://www.strava.com/oauth/authorize");
        authUrl.searchParams.set("client_id", STRAVA_CLIENT_ID);
        authUrl.searchParams.set("redirect_uri", REDIRECT_URI);
        authUrl.searchParams.set("response_type", "code");
        authUrl.searchParams.set("scope", SCOPE);
        authUrl.searchParams.set("approval_prompt", "auto");
        authUrl.searchParams.set("state", generateState());

        // Redirect to Strava
        window.location.href = authUrl.toString();
      }

      function generateState() {
        // Generate random state for CSRF protection
        return (
          Math.random().toString(36).substring(2, 15) +
          Math.random().toString(36).substring(2, 15)
        );
      }

      // Check if we're returning from Strava OAuth
      window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get("code");
        const error = urlParams.get("error");

        if (error) {
          alert("Strava authorization failed: " + error);
          return;
        }

        if (code) {
          // Show loading
          document.querySelector(".strava-button").style.display = "none";
          document.getElementById("loading").classList.add("show");
          document.querySelector(".loading-text").textContent =
            "Creating your account...";

          // Exchange code for token (backend endpoint needed)
          completeSignup(code);
        }
      });

      async function completeSignup(code) {
        try {
          // Call backend to complete signup
          const response = await fetch("/api/strava-signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ code }),
          });

          if (!response.ok) {
            throw new Error("Signup failed");
          }

          const data = await response.json();

          // Store session token
          localStorage.setItem("access_token", data.access_token);
          localStorage.setItem("user_id", data.user_id);

          // Redirect to dashboard
          window.location.href = "/dashboard";
        } catch (error) {
          console.error("Signup error:", error);
          alert("Failed to complete signup. Please try again.");
          window.location.href = "/signup";
        }
      }
    </script>
  </body>
</html>
